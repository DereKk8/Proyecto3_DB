CREATE OR REPLACE FUNCTION GAMA_MAS_VENDIDA
RETURN VARCHAR2
IS
GAMAS VARCHAR2(50 BYTE);
BEGIN
SELECT C.GAMA INTO GAMAS
FROM
(SELECT PRODUCTOS.GAMA, SUM(A.CANTIDAD) AS CANTIDAD
FROM
(SELECT CODIGOPRODUCTO, SUM(CANTIDAD) AS CANTIDAD
FROM DETALLEPEDIDOS
GROUP BY CODIGOPRODUCTO) A
INNER JOIN PRODUCTOS
ON A.CODIGOPRODUCTO = PRODUCTOS.CODIGOPRODUCTO
GROUP BY PRODUCTOS.GAMA
ORDER BY CANTIDAD DESC
FETCH FIRST 1 ROW ONLY) C;
RETURN GAMAS;
END;
